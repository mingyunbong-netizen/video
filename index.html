<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영상 비교 및 3D 모델 뷰어</title>
    <style>
        /* 기본 설정 */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow-x: hidden; /* 가로 스크롤 방지 */
        }

        /* ----------------------------------- */
        /* 상단: 영상 비교 섹션 스타일 */
        /* ----------------------------------- */
        .top-comparison-section {
            width: 100%;
            display: flex;
            justify-content: center; /* 뷰어 중앙 정렬 */
            padding: 30px 0;
            box-sizing: border-box;
            background-color: #f7f7f7; /* 섹션 배경색 */
        }

        .comparison-container {
            display: flex;
            width: 1000px; /* 고정 크기 유지 */
            height: 500px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* 왼쪽 패널: 업로드한 영상 (500px x 500px 고정) */
        .left-panel {
            width: 500px;
            height: 500px;
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: #f0f0f0;
        }

        /* 오른쪽 패널: 웹캠 피드 (500px x 500px 고정) */
        .right-panel {
            width: 500px;
            height: 500px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            background-color: #333333;
        }

        /* 영상 스타일 */
        #my-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 웹캠 화면 스타일 */
        #webcam-feed {
            width: 500px;
            height: 500px;
            background-color: #000;
            object-fit: cover;
            border: none;
            transform: scaleX(-1); /* 거울 모드 */
        }

        .loading-text {
            color: white;
            font-size: 1.2em;
            text-align: center;
            position: absolute; /* right-panel 내에서 상대적 위치 지정 */
            width: 500px;
        }

        /* ----------------------------------- */
        /* 하단: 3D 뷰어 섹션 스타일 */
        /* ----------------------------------- */

        #threejs-container {
            width: 100vw;
            /* 3D 뷰어의 높이. 필요에 따라 조절하세요. */
            height: 70vh; 
            overflow: hidden;
        }

        /* Three.js 캔버스가 이 컨테이너 안에 위치합니다. */
        #threejs-container canvas {
            display: block; /* 캔버스 아래 공백 제거 */
        }
    </style>
</head>
<body>

    <div class="top-comparison-section">
        <div class="comparison-container">
            <div class="left-panel">
                <video id="my-video" autoplay loop muted playsinline>
                    <source src="base.mp4" type="video/mp4">
                    죄송합니다. 귀하의 브라우저는 비디오 태그를 지원하지 않습니다.
                </video>
            </div>

            <div class="right-panel">
                <div id="loading-message" class="loading-text">
                    웹캠 접근을 요청 중입니다... 허용해 주세요.
                </div>
                <video id="webcam-feed" autoplay playsinline style="display: none;"></video>
            </div>
        </div>
    </div>

    <div id="threejs-container">
        </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        // ----------------------------------------------------
        // A. 웹캠/영상 비교 섹션 JavaScript
        // ----------------------------------------------------
        const videoElement = document.getElementById('webcam-feed');
        const loadingMessage = document.getElementById('loading-message');
        const myVideo = document.getElementById('my-video'); // 왼쪽 영상 요소

        // 1. 브라우저 정책을 우회하기 위한 스크립트
        if (myVideo) {
            myVideo.play().catch(error => {
                console.log("자동 재생이 차단되었습니다. 페이지를 클릭해 주세요.");
                document.addEventListener('click', () => {
                    myVideo.play().catch(e => console.log("재생 실패:", e));
                }, { once: true });
            });
        }

        // 2. 웹캠 접근 요청 함수
        async function startWebcam() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                loadingMessage.style.display = 'none';
                videoElement.style.display = 'block';
                videoElement.srcObject = stream;
            } catch (err) {
                console.error("웹캠 접근 권한 거부 또는 오류 발생:", err);
                loadingMessage.innerText = "웹캠 접근 권한이 거부되었습니다.";
                loadingMessage.style.color = '#ff6b6b';
            }
        }

        // 페이지 로드 시 웹캠 시작
        window.onload = startWebcam;


        // ----------------------------------------------------
        // B. 3D 모델 뷰어 섹션 JavaScript (Three.js)
        // ----------------------------------------------------
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const threeJsContainer = document.getElementById('threejs-container');

        // --- 전역 변수 및 설정 ---
        let intersectedObject = null;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();


        // 🌟🌟🌟 모델 크기 및 배치 설정 (이곳만 수정하세요!) 🌟🌟🌟
        const modelsToLoad = [
            { name: 'shoes.glb', scale: 10 },
            { name: 'bag.glb', scale: 7 },
            { name: 'ball.glb', scale: 5 },
            { name: 'book.glb', scale: 10 },
            { name: 'close.glb', scale: 5 },
            { name: 'glasses.glb', scale: 20 },
            { name: 'guard.glb', scale: 10 },
            { name: 'persimmon.glb', scale: 20 },
        ];

        const FIXED_POSITION_Y = -4.0; 
        const FIXED_POSITION_Z = 0.0;
        const MODEL_SPACING_X = 3.0;
        // 🌟🌟🌟 ------------------------------------ 🌟🌟🌟


        // 1. 기본 3요소 설정
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xffffff); // 배경색: 연한 회색으로 변경 (3D 섹션 구분을 위해)

        const camera = new THREE.PerspectiveCamera(50, threeJsContainer.clientWidth / threeJsContainer.clientHeight, 0.1, 1000);
        camera.position.set(0, 0, 15);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(threeJsContainer.clientWidth, threeJsContainer.clientHeight);
        threeJsContainer.appendChild(renderer.domElement); 

        // 2. 조명 설정
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
        directionalLight.position.set(5, 10, 7).normalize();
        scene.add(directionalLight);

        // 3. 컨트롤 설정
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.target.set(0, FIXED_POSITION_Y, 0); // 카메라 타겟을 모델 중심으로 설정
        controls.enablePan = false;
        controls.enableRotate = false; // 마우스 드래그를 모델 개별 회전에 사용하기 위해 궤도 회전은 비활성화
        controls.maxDistance = 20;
        controls.minDistance = 5;


        // 4. GLB 파일 로드!
        const loader = new GLTFLoader();
        const modelCount = modelsToLoad.length;
        const startX = -((modelCount - 1) * MODEL_SPACING_X) / 2;

        modelsToLoad.forEach((modelInfo, index) => {
            loader.load(
                modelInfo.name,
                function (gltf) {
                    const model = gltf.scene;

                    // X축 일렬 위치 계산
                    model.position.x = startX + (index * MODEL_SPACING_X);
                    // Y축 (높이) = -4.0 고정
                    model.position.y = FIXED_POSITION_Y;
                    // Z축 (깊이) = 0.0 고정
                    model.position.z = FIXED_POSITION_Z;

                    // 모델 크기 및 userData 설정
                    model.scale.set(modelInfo.scale, modelInfo.scale, modelInfo.scale);
                    model.userData.modelName = modelInfo.name;

                    scene.add(model);
                },
                undefined,
                function (error) {
                    console.error(`모델 로드 중 에러 발생: ${modelInfo.name}`, error);
                }
            );
        });


        // 5. 마우스 이벤트 리스너 추가 (개별 회전을 위한 핵심 로직)
        renderer.domElement.addEventListener('mousedown', onMouseDown, false);
        renderer.domElement.addEventListener('mousemove', onMouseMove, false);
        renderer.domElement.addEventListener('mouseup', onMouseUp, false);

        function onMouseDown(event) {
            // 마우스 좌표를 Three.js 정규화 좌표로 변환
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children, true);

            if (intersects.length > 0) {
                let target = intersects[0].object;
                while (target.parent && target.parent !== scene) {
                    target = target.parent;
                }

                if (target.parent === scene) {
                    intersectedObject = target;
                    isDragging = true;
                    previousMousePosition.x = event.clientX;
                    previousMousePosition.y = event.clientY;
                }
            }
        }

        function onMouseMove(event) {
            if (!isDragging || !intersectedObject) return;

            const deltaX = event.clientX - previousMousePosition.x;

            // Y축 회전 적용
            intersectedObject.rotation.y += deltaX * 0.01;

            previousMousePosition.x = event.clientX;
            previousMousePosition.y = event.clientY;
        }

        function onMouseUp(event) {
            isDragging = false;
            intersectedObject = null;
        }


        // 6. 렌더링 루프 (애니메이션)
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        animate();

        // 7. 창 크기 변경 시 화면 비율 유지 (웹캠/3D 뷰어 모두 대응)
        window.addEventListener('resize', () => {
            // 3D 뷰어 리사이징
            camera.aspect = threeJsContainer.clientWidth / threeJsContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(threeJsContainer.clientWidth, threeJsContainer.clientHeight);
        });
    </script>
</body>
</html>

지금 보면 화면이 두개로 나누어져 있고 3d 모델칸의 배경을 흰색으로 깔아줄수 있어?
